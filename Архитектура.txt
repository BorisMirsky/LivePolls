Примерный аналог программ Slido \ Mentimeter. 
Пользователи создают опросы, а участники голосуют в реальном времени. 
Результаты обновляются на экране мгновенно.


https://metanit.com/sharp/aspnet5/30.1.php
############################################################

Функциональность:
- опрос                                
  Юзер посылает заявку на создание опроса, админ создаёт (или нет?).   
      Вход в свой аккаунт -> Создать опрос (голосование, рейтингование)      
  Виден всем, обновляется мгновенно.
  Опрос состоит из вопроса (-ов) и вариантов ответа.
  Закрывается админом вручную (жизненный цикл).
  Непонятно: что в контроллере, что в хабах?


Регистрация\авторизация по токенам                            
- список юзеров из таблицы, входят и голосуют только они
- потом ещё сделать корпоративный аккаунт (?)


DB
- SQLight 
  Таблицы: Users, Polls, Results, Comments, Questions

- Модели (сущности)
  Повторяют таблицы

- ORM
  Dapper (не EFr, попробовать для практики)

############################################################

Real-time: ASP.NET Core SignalR — ядро проекта. 
Работа с группами (комната опроса), 
отправка сообщений конкретным клиентам (администратору опроса).

Производительность: Использование Scaleout с Redis Backplane, 
если проект масштабируется на несколько инстансов.

База данных: Хранение результатов голосований для истории и аналитики.
 Использование Dapper для быстрой вставки "голосов" пачками (batching).

Безопасность: Авторизация и аутентификация (JWT или Cookies). 
Проверка прав на управление опросом.

Сложность: Архитектура с разделением ответственности: отдельный хаб SignalR, 
сервис доменной логики, репозиторий.

###############################################################################

API (контроллеры и хабы SignalR, ASP.NET Core Web API + SignalR):
  Папка Controllers (для аутентификации, ...)
  Папка Hub (SignalR для Poll (опрос) - создание, редактирование, закрытие)
       - подключения клиентов, подписки на группы (комнаты) опросов, получение голосов и рассылку обновлений.

Application (логика обработки команд и запросов)
  Содержит Use Cases (например, CreatePollCommand, VoteCommand, GetPollResultsQuery).
  Здесь же будет обработка команд и запросов, возможно, с использованием медиатора (MediatR) для отделения вызова от реализации.
  В этом слое происходит валидация входных данных (например, с помощью FluentValidation) и преобразование данных между слоями.

Domain (модели и бизнес-правила)
  Сущности: Poll (опрос), PollOption (вариант ответа), Vote (голос).
  Poll содержит бизнес-правила: нельзя голосовать в закрытом опросе, нельзя голосовать дважды (если разрешено только один раз), время жизни опроса и т.д.
  Доменные события (Domain Events): например, PollCreatedEvent, VoteCastedEvent. Они могут использоваться для триггеринга дополнительных действий (например, отправка уведомлений).

Infrastructure (работа с внешними сервисами, например, базой данных, кэшем).
  Репозитории для доступа к данным: IPollRepository, IVoteRepository. Реализация с использованием Entity Framework Core (или Dapper для оптимизации) для работы с базой данных.
  База данных: можно использовать PostgreSQL или SQL Server. Таблицы: Polls, PollOptions, Votes.
  Кэширование: для хранения активных опросов и текущих результатов, чтобы снизить нагрузку на БД. Используется Redis или IMemoryCache (если проект развернут в одном экземпляре). Например, при голосовании голос сначала попадает в кэш, а затем фоново сохраняется в БД.
  Фоновые задачи: например, для периодического сохранения голосов из кэша в БД (если используется кэш) или для закрытия опросов по таймеру. Реализуются через BackgroundService или Hangfire.




-------------------------------------------------------------------------

                      Слои 

1 Web (контроллеры и хабы SignalR), 
-- REST API для управления опросами (контроллеры - создание, редактирование, закрытие). 
- SignalR Hub для реального времени: PollHub. 
       Он будет обрабатывать подключения клиентов, подписки на группы (комнаты) опросов, 
       получение голосов и рассылку обновлений.
- PollHub будет иметь методы:
    JoinPollGroup(pollId): подключение к группе опроса для получения обновлений.
    CastVote(pollId, optionId): отправка голоса.
    LeavePollGroup(pollId): выход из группы.
    При голосовании, после обработки команды в Application Layer, будет отправлено сообщение всем клиентам в группе опроса (через Hub.Clients.Group(pollId).SendAsync(...)) с обновленными результатами.


2 Infrastructure (работа с внешними сервисами, например, базой данных, кэшем).
-- Репозитории для доступа к данным: IPollRepository, IVoteRepository. 
   Entity Framework Core или Dapper 
-- Таблицы: Polls, PollOptions, Votes.
-- Кэширование: для хранения активных опросов и текущих результатов, 
          чтобы снизить нагрузку на БД. Используется Redis или IMemoryCache 
            (если проект развернут в одном экземпляре). 
            Например, при голосовании голос сначала попадает в кэш, а затем фоново сохраняется в БД.
-- Фоновые задачи: например, для периодического сохранения голосов из кэша в БД 
         (если используется кэш) или для закрытия опросов по таймеру. 
           Реализуются через BackgroundService или Hangfire.
    Для обработки большого количества одновременных голосов (например, при большом опросе) можно использовать очередь сообщений (RabbitMQ, Azure Service Bus) или каналы (Channel<T>). Голоса поступают в очередь, а фоновый worker обрабатывает их и обновляет результаты. Это гарантирует, что система не упадет при пиковой нагрузке.
    Для масштабирования SignalR можно использовать Redis Backplane, чтобы синхронизировать сообщения между несколькими экземплярами приложения.


3 Application (логика обработки команд и запросов)
-- Содержит Use Cases (например, CreatePollCommand, VoteCommand, GetPollResultsQuery).
-- Здесь же будет обработка команд и запросов, возможно, 
      с использованием медиатора (MediatR) для отделения вызова от реализации.
-- В этом слое происходит валидация входных данных 
       (например, с помощью FluentValidation) и преобразование данных между слоями.


4 Domain (модели и бизнес-правила)
-- Сущности: Poll (опрос), PollOption (вариант ответа), Vote (голос).
-- Poll содержит бизнес-правила: нельзя голосовать в закрытом опросе, нельзя голосовать дважды (если разрешено только один раз), время жизни опроса и т.д.
-- Доменные события (Domain Events): например, PollCreatedEvent, VoteCastedEvent. Они могут использоваться для триггеринга дополнительных действий (например, отправка уведомлений).

